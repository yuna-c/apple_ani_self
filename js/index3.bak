/*
1.ì¥ë©´ì„ ë‚˜ëˆˆë‹¤
2.ì¥ë©´ë³„ë¡œ ì• ë‹ˆë©”ì´ì…˜ì„ ì²˜ë¦¬í•˜ë„ë¡ í•œë‹¤.
*/

//1.ì¦‰ì‹œ í˜¸ì¶œ ë°°ì—´ í•¨ìˆ˜(í•¨ìˆ˜ ìë™ í˜¸ì¶œ)
//(function() {}) ();  ì „ì—­ë³€ìˆ˜ ë°”ëŒì§X 
(() =>{ // 1-1. ì§€ì—­ë³€ìˆ˜

    let YOffset = 0; // 4-2.ë³€ìˆ˜í™” window.pageYOffset ëŒ€ì‹  ì“¸ ë³€ìˆ˜
    let prevScrollHeight = 0; // 4-4. í˜„ì¬ ìŠ¤í¬ë¡¤ ìœ„ì¹˜(YOffset)ë³´ë‹¤ ì´ì „ì— ìœ„ì¹˜í•œ ìŠ¤í¬ë¡¤ ì„¹ì…˜ë“¤ì˜ ìŠ¤í¬ë¡¤ ë†’ì´ì˜ ê°’
    let currentScene = 0; // 4-5.í˜„ì¬ í™œì„±í™”ëœ(ëˆˆ ì•ì— ë³´ê³ ìˆëŠ”) ì”¬(scroll-section)
    // 13. currentSceneì„ ì¦ê°€/ê°ì†Œ ì‹œí‚¤ëŠ” í•¨ìˆ˜ì—ì„œ sceneì´ ë°”ë€ŒëŠ” ìˆœê°„ ë¬´ì‹œí•˜ëŠ” í•¨ìˆ˜
    let enterNewScene = false; // 13-1. ìƒˆë¡œìš´ sceneì´ ì‹œì‘ë˜ëŠ” ìˆœê°„ true

    // 38. ìŠ¤í¬ë¡¤ ê°€ì†ë„
    let acc = 0.1;
    let delayedYOffset = 0;
    let rafId;
    let rafState;

    const sceneInfo = [//ë°°ì—´ 
        {   
            //0
            type: 'sticky',  //1-0-3.íƒ€ì… 
            heightNum: 5,    //1-0-2.ë¸Œë¼ìš°ì € ë†’ì´ì˜ 5ë°° scrollHeight ì„¸íŒ…
            scrollHeight: 0, //1-0-1.ìŠ¤í¬ë¡¤ ë†’ì´
            objs: { //4.scroll-section ê°ì²´
                container: document.querySelector('#scroll-section-0'),
                // 7. css ì¤„ ani class ê°€ì ¸ì˜¤ê¸°
                messageA: document.querySelector('#scroll-section-0 .main-message.a'),
                messageB: document.querySelector('#scroll-section-0 .main-message.b'),
                messageC: document.querySelector('#scroll-section-0 .main-message.c'),
                messageD: document.querySelector('#scroll-section-0 .main-message.d'),
                // 19. ë¹„ë””ì˜¤ ì‚½ì…
                canvas: document.querySelector('#video-canvas-0'), // ë¹„ë””ì˜¤ ê°ì²´
                context: document.querySelector('#video-canvas-0').getContext('2d'),// context ê°ì²´
                videoImages: [], // ë¹„ë””ì˜¤ ë°°ì—´
            },
            values: { // 8. ì–´ë–¤ cssê°’ì„ ì–´ë–¤ì‹ìœ¼ë¡œ ë„£ì„ê±´ì§€ 

                // 19-1. ì´ë¯¸ì§€ ê°¯ìˆ˜, ì‹œí€€ìŠ¤ëŒ€ë¡œ 960ë²ˆê¹Œì§€ 
                videoImageCount: 300, // 0~299
                imageSequence: [0, 299], // ì´ë¯¸ì§€ ìˆœì„œ

                // 24.ìº”ë²„ìŠ¤ ë¶€ë“œëŸ½ê²Œ ì‚¬ë¼ì§€ê²Œ 
                canvas_opacity: [1, 0, { start: 0.9, end: 1 }],

                // 8-1.ì‹œì‘ê°’, ëê°’(ìŠ¤í¬ë¡¤ ì¤‘ê°„ ê°’ ê³„ì‚°í•´ì„œ ë„£ì„êº¼ì•¼)
                messageA_opacity_in: [0, 1, { start: 0.1, end: 0.2 }], // 8-2. sceneì´ ëë‚  ë•Œ aniê°™ì´ ëë‚˜ëŠ” ê±¸ë¡œ, messageAì˜ css ê°’ì„ ì„¸íŒ… 10%~20% ì§€ì  ë‚˜ì˜´
                // 13-5. ì„¸ë²ˆ ì§¸ ì›ì†Œ = íƒ€ì´ë°(ê°ì²´), ì• ë‹ˆë©”ì´ì…˜ ì¬ìƒë˜ëŠ” êµ¬ê°„(ë¹„ìœ¨ì´ê¸° ë•Œë¬¸ì— ì†Œìˆ˜ì )
                messageB_opacity_in: [0, 1, { start: 0.3, end: 0.4 }],
                messageC_opacity_in: [0, 1, { start: 0.5, end: 0.6 }],
                messageD_opacity_in: [0, 1, { start: 0.7, end: 0.8 }],

                messageA_opacity_out: [1, 0, { start: 0.25, end: 0.3 }],
                messageB_opacity_out: [1, 0, { start: 0.45, end: 0.5 }],
                messageC_opacity_out: [1, 0, { start: 0.65, end: 0.7 }],
                messageD_opacity_out: [1, 0, { start: 0.85, end: 0.9 }],

                // 16. translateY ë“±ì¥í•  ë•Œ ì„¸íŒ…
                messageA_translateY_in: [20, 0, { start: 0.1, end: 0.2 }], // 20% ~ 0%, íƒ€ì´ë° 
                messageB_translateY_in: [20, 0, { start: 0.3, end: 0.4 }],
                messageC_translateY_in: [20, 0, { start: 0.5, end: 0.6 }],
                messageD_translateY_in: [20, 0, { start: 0.7, end: 0.8 }],

                messageA_translateY_out : [0, -20, { start: 0.4, end: 0.45}], // 16-1. out
                messageB_translateY_out: [0, -20, { start: 0.45, end: 0.5 }],
                messageC_translateY_out: [0, -20, { start: 0.65, end: 0.7 }],
                messageD_translateY_out: [0, -20, { start: 0.85, end: 0.9 }],
            }
        },
        {   
            //1
            type: 'normal',
            //heightNum: 5, normal noí•„ìš”
            scrollHeight: 0, 
            objs:{ 
                container: document.querySelector('#scroll-section-1'),
                content: document.querySelector('#scroll-section-1 .description')
            },
        },
        {   
            //2
            type: 'sticky',
            heightNum: 5,
            scrollHeight: 0, 
            objs:{ 
                container: document.querySelector('#scroll-section-2'),
                messageA: document.querySelector('#scroll-section-2 .a'),
                messageB: document.querySelector('#scroll-section-2 .b'),
                messageC: document.querySelector('#scroll-section-2 .c'),
                pinB: document.querySelector('#scroll-section-2 .b .pin'),
                pinC: document.querySelector('#scroll-section-2 .c .pin'),

                // 25-1 ì´ë¯¸ì§€ ê°ì²´
                canvas: document.querySelector('#video-canvas-1'),
				context: document.querySelector('#video-canvas-1').getContext('2d'),
				videoImages: []
            },
            values: {
                // 25-2. ì´ë¯¸ì§€ ê°¯ìˆ˜
                videoImageCount: 960,
				imageSequence: [0, 959],
				canvas_opacity_in: [0, 1, { start: 0, end: 0.1 }],
				canvas_opacity_out: [1, 0, { start: 0.95, end: 1 }],

                messageA_translateY_in: [20, 0, { start: 0.15, end: 0.2 }],
                messageB_translateY_in: [30, 0, { start: 0.6, end: 0.65 }],
                messageC_translateY_in: [30, 0, { start: 0.87, end: 0.92 }],
                messageA_opacity_in: [0, 1, { start: 0.25, end: 0.3 }],
                messageB_opacity_in: [0, 1, { start: 0.6, end: 0.65 }],
                messageC_opacity_in: [0, 1, { start: 0.87, end: 0.92 }],
                messageA_translateY_out: [0, -20, { start: 0.4, end: 0.45 }],
                messageB_translateY_out: [0, -20, { start: 0.68, end: 0.73 }],
                messageC_translateY_out: [0, -20, { start: 0.95, end: 1 }],
                messageA_opacity_out: [1, 0, { start: 0.4, end: 0.45 }],
                messageB_opacity_out: [1, 0, { start: 0.68, end: 0.73 }],
                messageC_opacity_out: [1, 0, { start: 0.95, end: 1 }],
                pinB_scaleY: [0.5, 1, { start: 0.6, end: 0.65 }],
                pinC_scaleY: [0.5, 1, { start: 0.87, end: 0.92 }]
            }
        },
        {   
            //3
            type: 'sticky',
            heightNum: 5,
            scrollHeight: 0, 
            objs:{ 
                container: document.querySelector('#scroll-section-3'), 
                canvasCaption: document.querySelector('.canvas-caption'),
                // 26. ì´ë¯¸ì§€ ê°ì²´
                canvas: document.querySelector('.image-blend-canvas'),
                context: document.querySelector('.image-blend-canvas').getContext('2d'),

                // 27. ì´ë¯¸ì§€ ê²½ë¡œ ë‹´ì•„ì£¼ê¸°
                imagesPath: [
                    './images/blend-image-1.jpg',
                    './images/blend-image-2.jpg'
                ],
                images: [], // ë¹ˆë°°ì—´

            },
            values: {
                // 30-2. sceneinfo ë°°ì—´ì— í° ë°•ìŠ¤ì˜ x ì¢Œí‘œ ì„¸íŒ…
                rect1X: [ 0, 0, { start: 0, end: 0} ],
                rect2X: [ 0, 0, { start: 0, end: 0} ],
                // 35. ì´ë¯¸ì§€ ë¸”ë Œë”© Yì¢Œí‘œ
                blendHeight: [ 0, 0, { start: 0, end: 0 } ],
                // 36. ì´ë¯¸ì§€ ë¸”ë Œë”© í›„ ìº”ë²„ìŠ¤ ìŠ¤ì¼€ì¼
                canvas_scale: [ 0, 0, { start: 0, end: 0 } ],
                // 39. ë§ˆì§€ë§‰ ë¬¸ë‹¨ ì• ë‹ˆë©”ì´ì…˜, ìœ„ì¹˜
                canvasCaption_opacity: [ 0, 1, { start: 0, end: 0 } ],
				canvasCaption_translateY: [ 20, 0, { start: 0, end: 0 } ],
                rectStartY: 0, // 30-7. í•œë²ˆë§Œ ìŠ¤í¬ë¡¤í•˜ë©´ ê°’ì´ ë“¤ì–´ê°€ê²Œ(ê¸°ì¤€ì )
            }
        }
    ]; 
    // 20. ì´ë¯¸ì§€ ë°°ì—´ í•¨ìˆ˜
    function setCanvasImages(){
        let imgElem; // 20-1. ì´ë¯¸ì§€ ê°ì²´
        for (let i = 0; i < sceneInfo[0].values.videoImageCount; i++) { // 0 ~ 299
            //sceneInfo ì •ë³´ í™œìš©í•˜ê¸° ìœ„í•´
            //imgElem = document.createElement('img');
            imgElem = new Image();
            imgElem.src = `./video/001/IMG_${6726 + i}.JPG`;
            // 20-2. 
            sceneInfo[0].objs.videoImages.push(imgElem);
        }
        // 25-3. ì´ë¯¸ì§€ 2 ë°°ì—´í™”
        let imgElem2;
		for (let i = 0; i < sceneInfo[2].values.videoImageCount; i++) {
			imgElem2 = new Image();
			imgElem2.src = `./video/002/IMG_${7027 + i}.JPG`;
			sceneInfo[2].objs.videoImages.push(imgElem2);
		}
        // 28.ì´ë¯¸ì§€ ë¸”ëœë”© íŒŒì¼ ê°€ì ¸ì˜¤ê¸°
        let imgElem3;
        for (let i = 0; i < sceneInfo[3].objs.imagesPath.length; i++) {
            imgElem3 = new Image();
			imgElem3.src = sceneInfo[3].objs.imagesPath[i];
			sceneInfo[3].objs.images.push(imgElem3);
        }
        //console.log(sceneInfo[3].objs.images);
    }
    //console.log(sceneInfo[0].objs.videoImages);
    setCanvasImages();

    // 40. ë©”ë‰´ ìŠ¤í¬ë¡¤ ê³ ì •
    function checkMenu() {
        if (YOffset > 44){ // í˜„ì¬ ë¬¸ì„œì „ì²´ì˜ ìŠ¤í¬ë¡¤ëœ ìœ„ì¹˜ 
            document.body.classList.add('local-nav-sticky');
        } else {
            document.body.classList.remove('local-nav-sticky');
        }
    }

    // 2. í•¨ìˆ˜ìƒì„±
    function setLayout(){
        //ê° ìŠ¤í¬ë¡¤ ì„¹ì…˜ì˜ ë†’ì´ ì„¸íŒ…(normal/sticky)
        for (let i = 0; i < sceneInfo.length; i++) { // 2-1.i=0 ì´ê³  sceneinfoì˜ ê°¯ìˆ˜ +1

            // 17. sticky ë†’ì´ 
            if (sceneInfo[i].type === 'sticky') {
                sceneInfo[i].scrollHeight = sceneInfo[i].heightNum * window.innerHeight; // 2-2.windowscroll ë†’ì´
                sceneInfo[i].objs.container.style.height = `${sceneInfo[i].scrollHeight}px`; // 2-3.ì»¨í…Œì´ë„ˆscrollheight ì„¸íŒ…
            // `ë¬¸ìì—´` = ë°±í‹± (${ë³€ìˆ˜, ê°’})
            } else if (sceneInfo[i].type === 'normal')  {
				sceneInfo[i].scrollHeight = sceneInfo[i].objs.container.offsetHeight;
			}
            sceneInfo[i].objs.container.style.height = `${sceneInfo[i].scrollHeight}px`;
            
        }
        //console.log(sceneInfo);  

        // 6.currentScene ìë™ ì„¸íŒ… ê¸°ëŠ¥
        YOffset = window.pageYOffset; // 6-6 ë³€ìˆ˜ í†µì¼ê° ì„¸íŒ…

        let totalScrollHeight = 0; 
        for (let i = 0; i < sceneInfo.length; i++) {
            totalScrollHeight += sceneInfo[i].scrollHeight;  // 6-1. sceneInfoì˜ scrollheightë¥¼ ë”í•œ ê°’ì„ ë„£ê¸°
            if (totalScrollHeight >= YOffset) { // 6-2.í˜„ì¬ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ë‘ ë¹„êµ , totalScrollHeightê°€ í˜„ì¬ scrollìœ„ì¹˜ë³´ë‹¤ í¬ê±°ë‚˜ ê°™ì„ ë•Œ ë©ˆì¶°ì¤Œ
                currentScene = i; // 6-4. currentSceneì„ ië¡œ ì„¸íŒ…
                break; // 6-3. ë©ˆì¶”ê¸°
            }
        }
        // 6-5. ë°”ë””ì— show-scene ë²ˆí˜¸ ì‘ì—… 
        document.body.setAttribute('id', `show-scene-${currentScene}`);

        // 22. width,hegiht ë§ì¶”ê¸°
        const heightRatio = window.innerHeight / 1080; // 22-1. window.innerheightë¥¼ ë§ì¶”ê¸°
        sceneInfo[0].objs.canvas.style.transform = `translate3d(-50%, -50%, 0) scale(${heightRatio})`; //ê°ì²´ë¡œ ê°€ì ¸ì˜¤ê¸°(ì°½ ì‚¬ì´ì¦ˆ ë†’ì´ì— ë”± ë§ì¶°ì„œ ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì •) + ì„¼í„°ì •ë ¬translate3d(X,Y,Z),
		sceneInfo[2].objs.canvas.style.transform = `translate3d(-50%, -50%, 0) scale(${heightRatio})`;
    }

    /* ì²˜ìŒë¶€í„° ëê¹Œì§€ ì¬ìƒë˜ëŠ”ê²ƒ
    // 10. 9ë‹¤ìŒ 8-2ì˜ scrollê°’ ì• ë‹ˆ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜ 
    function calcValues(values, currentYOffset) {
        // values ë§¤ê°œë³€ìˆ˜ = opcityê°’ 0,1 ë³€í™”ì˜ ì‹œì‘ê³¼ ë ê°’, currentYOffset ë§¤ê°œë³€ìˆ˜ = í˜„ì¬ ì–¼ë§ˆë‚˜ ìŠ¤í¬ë¡¤ ë¬ëŠ”ì§€ 
        // 10-1. í˜„ì¬ scrollsectionì—ì„œ ì–¼ë§Œí¼ ìŠ¤í¬ë¡¤ì´ ë¬ëŠ”ì§€ ë¹„ìœ¨ êµ¬í•˜ê¸°

        // 11.ë³€ìˆ˜ ì„¸íŒ…
        let rv;
        //const scrollHeight = sceneInfo[currentScene].scrollHeight;
        // 11-2. í˜„ì¬ ì”¬ì—ì„œ ì–¼ë§Œí¼ ìŠ¤í¬ë¡¤ ë¬ëŠ”ì§€ ê°’ êµ¬í•˜ê¸° (í˜„ì¬ ì”¬ì˜ ì „ì²´ì˜ ë²”ìœ„ ë¶„ì˜ í˜„ì¬ ì–¼ë§Œí¼ ìŠ¤í¬ë¡¤ ë¬ëŠ”ì§€currentYOffset)
        let scrollRatio = currentYOffset / sceneInfo[currentScene].scrollHeight; // í˜„ì¬ ì”¬(ìŠ¤í¬ë¡¤ì„¹ì…˜)ì—ì„œ ìŠ¤í¬ë¡¤ëœ ë²”ìœ„ë¥¼ ë¹„ìœ¨ë¡œ êµ¬í•˜ê¸°
        // 11-3. return scrollRatio; ê°’ í™•ì¸ 

        //console.log( values.messageA_opacity );

        // 11-4. ìŠ¤í¬ë¡¤ ë¹„ìœ¨ì„ ê°’ì˜ ì „ì²´ ë²”ìœ„ì— ê³±í•¨, parseInt() ì†Œìˆ«ì  ì œê±°[ì •ìˆ˜ì²˜ë¦¬]
        //rv = parseInt(scrollRatio * 300); // 11-5. values2-values1
        rv = scrollRatio * (values[1] - values[0]) + values[0];

        return rv;
        
    }
    */

    /* 13-6. íƒ€ì„ë¼ì¸ ë³„ë¡œ ì¬ìƒí•˜ê²Œ ìˆ˜ì •, ë¶„ê¸°ì²˜ë¦¬ */
    function calcValues(values, currentYOffset) {
        let rv;
        
        // 13-9. ìƒìˆ˜
        const scrollHeight = sceneInfo[currentScene].scrollHeight;
		const scrollRatio = currentYOffset / scrollHeight;

        // 13-7 ë¶„ê¸°ì²˜ë¦¬
        if( values.length === 3 ){
            //start ~ end ì‚¬ì´ì˜ ì• ë‹ˆë©”ì´ì…˜ ì‹¤í–‰
            // 13-8. ìŠ¤í¬ë¡¤ ì‹œì  êµ¬í•˜ê¸° *(ê³±í•˜ê¸°)
            const partScrollStart = values[2].start * scrollHeight;
            const partScrollEnd = values[2].end * scrollHeight;
            const partScrollHeight = partScrollEnd - partScrollStart;  

            if (currentYOffset >= partScrollStart && currentYOffset <= partScrollEnd) { //ë§Œì•½ ì‚¬ì´êµ¬ê°„ì— ë“¤ì–´ì™”ì„ ê²½ìš° && partScrollStartë³´ë‹¤ í¬ê±°ë‚˜ ê°™ê³  , partScrollendë³´ë‹¤ ì‘ê±°ë‚˜ ê°™ìœ¼ë©´
                // 13-9. ë¶€ë¶„ ìŠ¤í¬ë¡¤ ì˜ì—­ (ì „ì²´ - ìŠ¤í¬ë¡¤ ì˜ì—­) 
				rv = (currentYOffset - partScrollStart) / partScrollHeight * (values[1] - values[0]) + values[0];
			} else if (currentYOffset < partScrollStart) { // partScrollStartì´ ì‘ìœ¼ë©´ ì´ˆê¹ƒê°’ 0
				rv = values[0];
			} else if (currentYOffset > partScrollEnd) { // partScrollEndì´ í¬ë©´ 1
				rv = values[1];
			}
            
        } else {
            rv = scrollRatio * (values[1] - values[0]) + values[0];
        }

        return rv;
        
    }

    // 9. ì• ë‹ˆë©”ì´ì…˜ ì²˜ë¦¬ í•¨ìˆ˜
    /*
    function playAnimation() {
        // 10-4. opacity ë³€ìˆ˜ ì²˜ë¦¬
		const objs = sceneInfo[currentScene].objs; //sceneInfo.objs ë³€ìˆ˜ DOM
		const values = sceneInfo[currentScene].values; //sceneInfo.values ë³€ìˆ˜, ê°’
        const currentYOffset = YOffset - prevScrollHeight; // 10-8. YOffest - prevScrollHeight(í˜„ì¬ sceneì—ì„œ ì–¼ë§ˆë‚˜ ìŠ¤í¬ë¡¤ í–ˆëŠ”ì§€ ë‚˜ì˜´)
        const scrollHeight = sceneInfo[currentScene].scrollHeight; // 15-1. ìŠ¤í¬ë¡¤ ëœ ë‚˜ë¨¸ì§€ ê°’
        const scrollRatio = currentYOffset / scrollHeight; // 15-3 ìœ„ì˜ ë³€ìˆ˜ë¡œ ì¹˜í™˜
        //const scrollRatio = (yOffset - prevScrollHeight) / scrollHeight; ì•ˆë¨ //15. í˜„ì¬ ì”¬ì—ì„œ ì–¼ë§ˆë‚˜ ìŠ¤í¬ë¡¤ ë˜ì—ˆëŠ”ì§€, yOffset(ì „ì²´ ë¬¸ì„œì—ì„œ í˜„ì¬ ìŠ¤í¬ë¡¤ ê°’) - prevScrollHeight / í˜„ì¬ ì”¬ì˜ scrollHeight
        
        // 11-6 values ê°’ ì°íˆëŠ” ì§€
        //console.log(values.messageA_opacity);
        // 10-7. values ì°íˆëŠ” ì§€ ë³´ê¸° 
        //console.log(currentScene, currentYOffset);

        //12. í˜„ì¬ í™œì„±í™” ëœ ì”¬ ì¶œë ¥ console.log(currentScene);
        // 13-5. console.log(currentScene);
        switch (currentScene){
            // 9-1. ê° ì”¬ì— í•´ë‹¹ë˜ëŠ” ì• ë“¤ë§Œ play
            case 0: 
                //console.log('0 play');
                // 10-2. css
                // 11-8. calcValues();
                //let messageA_opacity_0 = sceneInfo[0].values.messageA_opacity[0]; // 10-3. messageA_opacity: [0]
                //let messageA_opacity_1 = sceneInfo[1].values.messageA_opacity[1]; // 10-3. messageA_opacity: [1]
                // 11-7. let messageA_opacity_0 = values.messageA_opacity[0]; // 10-5. ì“°ê¸° í¸í•˜ê²Œ
                // 11-7. let messageA_opacity_1 = values.messageA_opacity[1];
                //const messageA_opacity_in = calcValues(values.messageA_opacity_in, currentYOffset);
                //const messageA_opacity_out = calcValues(values.messageA_opacity_out, currentYOffset); // 14-1. out ë³€ìˆ˜ì²˜ë¦¬
                // 16-2 translateY ì„¸íŒ…
                //const messageA_translateY_in = calcValues(values.messageA_translateY_in, currentYOffset);
                //const messageA_translateY_out = calcValues(values.messageA_translateY_out, currentYOffset);

                // 15-2. scrollRatioê°€ 0.22 ë³´ë‹¤ ì‘ê±°ë‚˜ ê°™ìœ¼ë©´
                if (scrollRatio <= 0.22) {
                    // in
                    objs.messageA.style.opacity =calcValues(values.messageA_opacity_in, currentYOffset);
                    objs.messageA.style.transform = `translateY(${calcValues(values.messageA_opacity_out, currentYOffset)}%)`; // 16-3. translateY
                } else {
                    // out
                    objs.messageA.style.opacity =calcValues(values.messageA_opacity_out, currentYOffset);
                    objs.messageA.style.transform = `translateY(${calcValues(values.messageA_translateY_out, currentYOffset)}%)`; // 16-3. translateY
                }
                // 14-2. ì¡°ê±´ì´ ê²¹ì¹¨ objs.messageA.style.opacity = messageA_opacity_out; 
                // 10-6. ê°’ ì°íˆëŠ”ì§€ ë³´ê¸° console.log( messageA_opacity_0, messageA_opacity_1);
                // 10-8. í˜¸ì¶œ, 12-1. opacityê°’ ì¶œë ¥
                console.log(messageA_opacity_out);
                //console.log( calcValues(values.messageA_opacity, currentYOffset) );
                break;
            case 1:
                //console.log('1 play');
                break;
            case 2:
                //console.log('2 play');
                break;
            case 3:
                //console.log('3 play');
                break;
        }
    }
    */

    //18 ì• ë‹ˆë©”ì´ì…˜ ì •ë¦¬
    function playAnimation() {
        // 10-4. opacity ë³€ìˆ˜ ì²˜ë¦¬
		const objs = sceneInfo[currentScene].objs;
		const values = sceneInfo[currentScene].values; 
        const currentYOffset = YOffset - prevScrollHeight; 
        const scrollHeight = sceneInfo[currentScene].scrollHeight;
        const scrollRatio = currentYOffset / scrollHeight;
      
        switch (currentScene){
            case 0: 
                // 21.ì‹œí€€ìŠ¤ ì°ê¸°
                //let sequence = Math.round(calcValues(values.imageSequence, currentYOffset)); //math.round ì •ìˆ˜ ë°˜ì˜¬ë¦¼ ì²˜ë¦¬
                //console.log(sequence);
                // 21-1. ì»¨í…ìŠ¤ íŠ¸ ê°œì²´ ê·¸ë¦¬ê¸°
                //objs.context.drawImage(objs.videoImages[sequence], 0, 0);// í•´ë‹¹ ì´ë¯¸ì§€ ê°ì²´, x, y, width, height
                // 24-1 íˆ¬ëª…ë„ ì ìš©
                objs.canvas.style.opacity = calcValues(values.canvas_opacity, currentYOffset);
                
                if (scrollRatio <= 0.22) {
                    // in
                    objs.messageA.style.opacity =calcValues(values.messageA_opacity_in, currentYOffset);
                    objs.messageA.style.transform = `translate3d(0, ${calcValues(values.messageA_translateY_in, currentYOffset)}%, 0)`; // 16-3. translateY
                      //(X), ${Y}%, Z (3d ë¶™ì€ ì• ë“¤ì€ í¼í¬ë¨¼ìŠ¤ ì¢‹ê³ , í•˜ë“œì›¨ì–´ ê°€ì† ë³´ì¥)
                } else {
                    // out
                    objs.messageA.style.opacity =calcValues(values.messageA_opacity_out, currentYOffset);
                    objs.messageA.style.transform = `translate3d(0, ${calcValues(values.messageA_translateY_out, currentYOffset)}%, 0)`; // 16-3. translateY
                }
                //console.log(messageA_opacity_out);

                if (scrollRatio <= 0.42) {
                    // in
                    objs.messageB.style.opacity = calcValues(values.messageB_opacity_in, currentYOffset);
                    objs.messageB.style.transform = `translate3d(0, ${calcValues(values.messageB_translateY_in, currentYOffset)}%, 0)`;
                } else {
                    // out
                    objs.messageB.style.opacity = calcValues(values.messageB_opacity_out, currentYOffset);
                    objs.messageB.style.transform = `translate3d(0, ${calcValues(values.messageB_translateY_out, currentYOffset)}%, 0)`;
                }
    
                if (scrollRatio <= 0.62) {
                    // in
                    objs.messageC.style.opacity = calcValues(values.messageC_opacity_in, currentYOffset);
                    objs.messageC.style.transform = `translate3d(0, ${calcValues(values.messageC_translateY_in, currentYOffset)}%, 0)`;
                } else {
                    // out
                    objs.messageC.style.opacity = calcValues(values.messageC_opacity_out, currentYOffset);
                    objs.messageC.style.transform = `translate3d(0, ${calcValues(values.messageC_translateY_out, currentYOffset)}%, 0)`;
                }
    
                if (scrollRatio <= 0.82) {
                    // in
                    objs.messageD.style.opacity = calcValues(values.messageD_opacity_in, currentYOffset);
                    objs.messageD.style.transform = `translate3d(0, ${calcValues(values.messageD_translateY_in, currentYOffset)}%, 0)`;
                } else {
                    // out
                    objs.messageD.style.opacity = calcValues(values.messageD_opacity_out, currentYOffset);
                    objs.messageD.style.transform = `translate3d(0, ${calcValues(values.messageD_translateY_out, currentYOffset)}%, 0)`;
                }

                break;
            case 1:
                //console.log('1 play');
                break;
            case 2:
                // console.log('2 play');
                // 25-5. ì´ë¯¸ì§€ ê°ì²´ ë¶ˆëŸ¬ì˜¤ê¸°
                //let sequence2 = Math.round(calcValues(values.imageSequence, currentYOffset));
				//objs.context.drawImage(objs.videoImages[sequence2], 0, 0);

                //  25-6. ì´ë¯¸ì§€ íˆ¬ëª…ë„ ë¶€ë“œëŸ½ê²Œ ë‚˜ëˆ„ê¸°
                if (scrollRatio <= 0.5) {
                    objs.canvas.style.opacity = calcValues(values.canvas_opacity_in, currentYOffset);
                } else {
                    objs.canvas.style.opacity = calcValues(values.canvas_opacity_out, currentYOffset);
                }

                if (scrollRatio <= 0.32) {
                    // in
                    objs.messageA.style.opacity = calcValues(values.messageA_opacity_in, currentYOffset);
                    objs.messageA.style.transform = `translate3d(0, ${calcValues(values.messageA_translateY_in, currentYOffset)}%, 0)`;
                } else {
                    // out
                    objs.messageA.style.opacity = calcValues(values.messageA_opacity_out, currentYOffset);
                    objs.messageA.style.transform = `translate3d(0, ${calcValues(values.messageA_translateY_out, currentYOffset)}%, 0)`;
                }

                if (scrollRatio <= 0.67) {
                    // in
                    objs.messageB.style.transform = `translate3d(0, ${calcValues(values.messageB_translateY_in, currentYOffset)}%, 0)`;
                    objs.messageB.style.opacity = calcValues(values.messageB_opacity_in, currentYOffset);
                    objs.pinB.style.transform = `scaleY(${calcValues(values.pinB_scaleY, currentYOffset)})`;
                } else {
                    // out
                    objs.messageB.style.transform = `translate3d(0, ${calcValues(values.messageB_translateY_out, currentYOffset)}%, 0)`;
                    objs.messageB.style.opacity = calcValues(values.messageB_opacity_out, currentYOffset);
                    objs.pinB.style.transform = `scaleY(${calcValues(values.pinB_scaleY, currentYOffset)})`;
                }

                if (scrollRatio <= 0.93) {
                    // in
                    objs.messageC.style.transform = `translate3d(0, ${calcValues(values.messageC_translateY_in, currentYOffset)}%, 0)`;
                    objs.messageC.style.opacity = calcValues(values.messageC_opacity_in, currentYOffset);
                    objs.pinC.style.transform = `scaleY(${calcValues(values.pinC_scaleY, currentYOffset)})`;
                } else {
                    // out
                    objs.messageC.style.transform = `translate3d(0, ${calcValues(values.messageC_translateY_out, currentYOffset)}%, 0)`;
                    objs.messageC.style.opacity = calcValues(values.messageC_opacity_out, currentYOffset);
                    objs.pinC.style.transform = `scaleY(${calcValues(values.pinC_scaleY, currentYOffset)})`;
                }

                // 33. currentScene 3ì—ì„œ ì“°ëŠ” ìº”ë²„ìŠ¤ë¥¼ ë¯¸ë¦¬ ê·¸ë ¤ì£¼ê¸° ì‹œì‘
				if (scrollRatio > 0.9) {
					const objs = sceneInfo[3].objs;
					const values = sceneInfo[3].values;
					const widthRatio = window.innerWidth / objs.canvas.width;
					const heightRatio = window.innerHeight / objs.canvas.height;
					let canvasScaleRatio;

					if (widthRatio <= heightRatio) {
						// ìº”ë²„ìŠ¤ë³´ë‹¤ ë¸Œë¼ìš°ì € ì°½ì´ í™€ì­‰í•œ ê²½ìš°
						canvasScaleRatio = heightRatio;
					} else {
						// ìº”ë²„ìŠ¤ë³´ë‹¤ ë¸Œë¼ìš°ì € ì°½ì´ ë‚©ì‘í•œ ê²½ìš°
						canvasScaleRatio = widthRatio;
					}

					objs.canvas.style.transform = `scale(${canvasScaleRatio})`;
					objs.context.fillStyle = 'white';
					objs.context.drawImage(objs.images[0], 0, 0);

					// ìº”ë²„ìŠ¤ ì‚¬ì´ì¦ˆì— ë§ì¶° ê°€ì •í•œ innerWidthì™€ innerHeight
					const recalculatedInnerWidth = document.body.offsetWidth / canvasScaleRatio;
					const recalculatedInnerHeight = window.innerHeight / canvasScaleRatio;

					const whiteRectWidth = recalculatedInnerWidth * 0.15;
					values.rect1X[0] = (objs.canvas.width - recalculatedInnerWidth) / 2;
					values.rect1X[1] = values.rect1X[0] - whiteRectWidth;
					values.rect2X[0] = values.rect1X[0] + recalculatedInnerWidth - whiteRectWidth;
					values.rect2X[1] = values.rect2X[0] + whiteRectWidth;

					// ì¢Œìš° í°ìƒ‰ ë°•ìŠ¤ ê·¸ë¦¬ê¸°
					objs.context.fillRect(
						parseInt(values.rect1X[0]),
						0,
						parseInt(whiteRectWidth),
						objs.canvas.height
					);
					objs.context.fillRect(
						parseInt(values.rect2X[0]),
						0,
						parseInt(whiteRectWidth),
						objs.canvas.height
					);
				}
                
                break;
            case 3:
                //34. ìŠ¤í¬ë¡¤ì´ ë˜ëŠ” ì‹œì  êµ¬í•˜ê¸°
                let step = 0; //ì‹œì ì´ ë³€í•´ì•¼ë˜ë‹ˆê¹Œ let

                //console.log('3 play');
                // 26-1. ìŠ¤í¬ë¡¤ ìœ ë™ì  ì´ë¯¸ì§€(ì–´ë–¤ í•´ìƒë„ì—ë„ ëŒ€ì‘ í•  ìˆ˜ ìˆëŠ” )
                // ê°€ë¡œ ì„¸ë¡œ ëª¨ë‘ ê½‰ ì°¨ê²Œ í•˜ê¸°ìœ„í•´ ì—¬ê¸°ì„œ ì„¸íŒ…(ê³„ì‚°)
                // ì›ë˜ ìº”ë²„ìŠ¤í¬ê¸°ì˜ ê°€ë¡œì— ëŒ€í•œ ë¸Œë¼ìš°ì €ì˜ í­ì˜ ë¹„ìœ¨ / ìº”ë²„ìŠ¤ ì›ë˜ ë†’ì´ì— ëŒ€í•œ ë¸Œë¼ìš°ì €ì˜ ë†’ì´ì— ëŒ€í•œ ë¹„ìœ¨ 
                const widthRatio = window.innerWidth / objs.canvas.width; // ìº”ë²„ìŠ¤ í¬ê¸° / ë¸Œë¼ìš°ì €ì˜ í­
                const heightRatio = window.innerHeight / objs.canvas.height; // ìº”ë²„ìŠ¤ ë†’ì´ / ë¸Œë¼ìš°ì €ì˜ ë†’ì´
                
                //console.log(widthRatio, heightRatio);
                let canvasScaleRatio;

                //ìº”ë²„ìŠ¤ í¬ê¸°ë‘ width,heightë¥¼ ë¹„êµí•´ ì–¼ë§Œí¼ ì¡°ì ˆì„ í•  ê»€ì§€ ì •í•´ì¤˜ì•¼í•¨

                if (widthRatio <= heightRatio) {// widthê°€ heightë³´ë‹¤ ì‘ì„ ë•Œ
                    canvasScaleRatio = heightRatio; //height ë¹„ìœ¨ ë”°ë¼ê° (ìº”ë²„ìŠ¤ë³´ë‹¤ ë¸Œë¼ìš°ì € ì°½ì´ í™€ì­‰í•œ ê²½ìš°)
                    //console.log(heightRatio, 'heightRatio ë¹„ìœ¨ë¡œ ê²°ì •');
                } else {
                    canvasScaleRatio = widthRatio; //width ë¹„ìœ¨ ë”°ë¼ê° (ìº”ë²„ìŠ¤ë³´ë‹¤ ë¸Œë¼ìš°ì € ì°½ì´ ë‚©ì‘í•œ ê²½ìš°)
                    //console.log(widthRatio,'widthRatio ë¹„ìœ¨ë¡œ ê²°ì •');
                }
                // ìº”ë²„ìŠ¤ ìŠ¤ì¼€ì¼ì„ canvasScaleRatioë¡œ ì„¸íŒ… (ë¹„ìœ¨ ë§ì¶”ê¸°)
                objs.canvas.style.transform = `scale(${canvasScaleRatio})`;
                // 31. ìº”ë²„ìŠ¤ ìƒ‰ ê·¸ë¦¬ê¸°
                objs.context.fillStyle = 'white';
                // 29. ìº”ë²„ìŠ¤ë¡œ ì´ë¯¸ì§€ ê·¸ë¦¬ê¸°
                objs.context.drawImage(objs.images[0], 0, 0);//ì´ë¯¸ì§€ì¦ˆ ë°°ì—´ì˜ ì²«ë²ˆì§¸ ê°ì²´ ê·¸ë¦¬ê¸°

                // 30. í•˜ì–€ ë°•ìŠ¤ ê·¸ë¦¬ê¸° ìº”ë²„ìŠ¤ì‚¬ì´ì¦ˆì— ë§ì¶° ê°€ì •í•œ innerwidth,innerheight
                //const recalculatedInnerWidth = window.innerWidth / canvasScaleRatio; //1920
                //const recalculatedInnerHeight = window.innerHeight / canvasScaleRatio; //1080
                // 30-10. ìŠ¤í¬ë¡¤ë°” ë¯¸í¬í•¨ìœ¼ë¡œ
                /*
                window.innerWidth
                2560
                document.body.offsetWidth
                2543
                */
                const recalculatedInnerWidth = document.body.offsetWidth / canvasScaleRatio; //1920
                const recalculatedInnerHeight = document.body.offsetWidth / canvasScaleRatio; //1080
                //console.log(recalculatedInnerWidth,recalculatedInnerHeight);

                //console.log('3 start');
                // 30-5. 3ë²ˆ ì”¬ì´ ì‹œì‘ë ë•Œ, -xì¢Œí‘œê°’ìœ¼ë¡œ, ìº”ë²„ìŠ¤ ìœ—ë¶€ë¶„ì´ ë‹¿ì•˜ì„ë•Œ ê·¸ë¦¼ì´ ì‚¬ë¼ì§€ê²Œ 
                //(ì›€ì§ì¸ yì¢Œí‘œê°’ êµ¬í•˜ê¸° = getBoundingClientRect() í™”ë©´ìƒì— ìˆëŠ” ì˜¤ë¸Œì íŠ¸ì˜ í¬ê¸°ì™€ ìœ„ì¹˜ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë©”ì„œë“œ)
                //ìº”ë²„ìŠ¤ top
                // 30-8. ë§Œì•½ valuesì˜ rectStartYê°’ì´ ì„¸íŒ…ì´ ì•ˆë˜ì–´ìˆë‹¤ë©´
                if(!values.rectStartY){
                    //values.rectStartY = objs.canvas.getBoundingClientRect().top;
                    //console.log(objs.canvas.getBoundingClientRect()); // 30-6.ìº”ë²„ìŠ¤ì— ëŒ€í•œ ì •ë³´ë¥¼ ì‹œì‘ì‹œì ì— í•œë²ˆë§Œ ê°€ì ¸ì˜¤ë„ë¡ ë³€í™˜
                    //console.log(values.rectStartY);
                    values.rectStartY = objs.canvas.offsetTop + (objs.canvas.height - objs.canvas.height * canvasScaleRatio) / 2;
                    // 30-11. ìœ„ì—ì„œ ì–¼ë§ˆë‚˜ ë–¨ì–´ì ¸ ìˆëŠëƒ(ê³ ì •ê°’) + ( ì›ë˜ìº”ë²„ìŠ¤ ë†’ì´ - ì¤„ì–´ë“  ìº”ë²„ìŠ¤ì˜ ë†’ì´(ì›ë˜ìº”ë²„ìŠ¤ë†’ì´ * ë¹„ìœ¨) ) /2; íƒ‘ê°’ ì–»ì–´ë‚´ê¸° -> ìŠ¤ì¼€ì¼ì´ ëŠ˜ë ¤ì ¸ ìˆì–´ì„œ ìš”ì†Œì˜ ì›ë˜ìœ„ì¹˜ë‚˜ í¬ê¸°ì— ì˜í–¥ì„ ì•ˆì¤Œ(ê¸°ë³¸ì ìœ¼ë¡œ ì°¨ì§€í•˜ëŠ” ê³µê°„ì˜ì—­ì´ ì•ˆë³€í•¨) 
                    console.log(values.rectStartY);
                    // 32. í°ë°•ìŠ¤ ìŠ¤íƒ€íŠ¸ ì‹œì  ì •í•˜ê¸°( ì°½ì‚¬ì´ì¦ˆì˜ ì ˆë°˜ ë†’ì´ì— í•´ë‹¹ë˜ëŠ” ì •ë„ë¥¼ ì „ì²´ ìŠ¤í¬ë¡¤heightì— ëŒ€í•œ ë¹„ìœ¨ë¡œ êµ¬í•¨ )
                    values.rect1X[2].start = (window.innerHeight / 2) / scrollHeight;
                    values.rect2X[2].start = (window.innerHeight / 2) / scrollHeight;
                    values.rect1X[2].end = values.rectStartY / scrollHeight; //ì„¸ë²ˆì§¸ ì›ì†Œ íƒ€ì´ë°()
                    values.rect2X[2].end = values.rectStartY / scrollHeight;
                }
                

                // 30-1. í•˜ì–€ ë°•ìŠ¤ì˜ í­ ë³€ìˆ˜ë‹´ê¸°(ìƒëŒ€ê°’)
                const whiteRectWidth = recalculatedInnerWidth * 0.15;
               
                // 30-3. í° ë°•ìŠ¤ ê³„ì‚°
                values.rect1X[0] = (objs.canvas.width - recalculatedInnerWidth) / 2; //ì²«ë²ˆì§¸ ë°•ìŠ¤xì¢Œí‘œ, ìº”ë²„ìŠ¤width - ë‹¤ì‹œê³„ì‚°innerwidth /2
				values.rect1X[1] = values.rect1X[0] - whiteRectWidth; // 1ë²ˆ ì¸ë±ìŠ¤, ë²Œì–´ì§€ëŠ” í™”ë©´ ë°–ìœ¼ë¡œë‚˜ê°€ëŠ” 1ë²ˆ ë°•ìŠ¤ê°€ í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°„ë‹¤. ,ì¢Œí‘œ - ëìª½ í­
				values.rect2X[0] = values.rect1X[0] + recalculatedInnerWidth - whiteRectWidth; //ë‘ë²ˆì§¸ ë°•ìŠ¤ ì²«ë²ˆì§¸ ë°•ìŠ¤ xì¢Œí‘œì—ì„œ ë‹¤ì‹œê³„ì‚°innerwidth - ìê¸° í­
				values.rect2X[1] = values.rect2X[0] + whiteRectWidth;

                // 30-4. ì¢Œìš° í°ìƒ‰ ë°•ìŠ¤ ê·¸ë¦¬ê¸° ìº”ë²„ìŠ¤ì—ì„œ ì‚¬ê°í˜• ê·¸ë¦¬ëŠ” ì¸ë±ìŠ¤ : fillRect
                //objs.context.fillRect(values.rect1X[0], 0, parseInt(whiteRectWidth), objs.canvas.height);// x, y, width(ìº”ë²„ìŠ¤ë¹„ìœ¨ë¡œ ë‹¤ì‹œê³„ì‚°í•´ì„œ ì •ìˆ˜ì²˜ë¦¬), height
                //objs.context.fillRect(values.rect2X[0], 0, parseInt(whiteRectWidth), recalculatedInnerWidth);
                //objs.context.fillRect(values.rect2X[0], 0, parseInt(whiteRectWidth), objs.canvas.height);
                // 30-9 ì• ë‹ˆë©”ì´ì…˜ ê°±ì‹  ìœ„í•´ calcvaluesì˜ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                objs.context.fillRect(parseInt(calcValues(values.rect1X, currentYOffset)), 
                    0, 
                    parseInt(whiteRectWidth), 
                    objs.canvas.height
                );
                objs.context.fillRect(parseInt(calcValues(values.rect2X, currentYOffset)), 
                    0, 
                    parseInt(whiteRectWidth), 
                    objs.canvas.height
                );

                if (scrollRatio < values.rect1X[2].end) { // 34-1. ìº”ë²„ìŠ¤ê°€ ë¸Œë¼ìš°ì € ìƒë‹¨ì— ë‹¿ì§€ ì•Šì•˜ë‹¤ë©´(í°ë°•ìŠ¤ê°€ ëœ ì›€ì§ì˜€ë‹¤ë©´) , ë°•ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ì´ ëë‚˜ëŠ” ì§€ì ë³´ë‹¤ ì‘ìœ¼ë©´
                    // ì—¬ê¸°ë¥¼ step1ë¡œ
                    step = 1; 
                    //console.log('ìº”ë²„ìŠ¤ ë‹¿ê¸° ì „');
                    objs.canvas.classList.remove('sticky');
                } else {
                    step = 2;
                    //console.log('ìº”ë²„ìŠ¤ ë‹¿ì€ í›„ ğŸ˜ˆ');
                    // 35-2. blendHeight ì„¸íŒ…
                    values.blendHeight[0] = 0; 
                    values.blendHeight[1] = objs.canvas.height;
                    //ìŠ¤í¬ë¡¤ ì‹œì 
                    values.blendHeight[2].start = values.rect1X[2].end; // 35-3. ì´ë¯¸ì§€ 1ì´ ìŠ¤í¬ë¡¤ ë‹¤ëœ ì‹œì 
                    values.blendHeight[2].end = values.blendHeight[2].start + 0.2; // 35-4. ìŠ¤í¬ë¡¤ ì†ë„
                    const blendHeight = calcValues(values.blendHeight, currentYOffset); // 35-6.  35-5ì˜ blendHeight;

                    // 35-1. blendHeight [ 0, 0, { start: 0, end: 0} ] ìŠ¤í¬ë¦½íŠ¸ë¡œ ê³„ì‚°
                    objs.context.drawImage(objs.images[1],
                        0, objs.canvas.height - blendHeight, objs.canvas.width, blendHeight, // 35-5.ì†ŒìŠ¤ ì´ë¯¸ì§€ì—ì„œ ê°€ì ¸ì˜¨ê²ƒ(blendHeight ê³„ì‚°ì˜ ê²°ê³¼ê°’)
                        0, objs.canvas.height - blendHeight, objs.canvas.width, blendHeight
                    ); //ì´ë¯¸ì§€ê°ì²´(ë¹„ë””ì˜¤, ë˜ë‹¤ë¥¸ ìº”ë²„ìŠ¤), x, y, width, height
                    
                    objs.canvas.classList.add('sticky');
                    //34-2. offset.Top - (ì›ë˜ìº”ë²„ìŠ¤height * ìº”ë²„ìŠ¤ë¹„ìœ¨) /2px
                    objs.canvas.style.top = `${-(objs.canvas.height - objs.canvas.height * canvasScaleRatio) / 2}px`; 
                    // ì¡°ì •ëœ ìº”ë²„ìŠ¤ í¬ê¸° = {-(ì›ë˜ ìº”ë²„ìŠ¤ì˜ ë†’ì´1080(1) - ì›ë˜ ìº”ë²„ìŠ¤ì˜ ë†’ì´1080 * í™•ëŒ€ì¶•ì†Œë¹„ìœ¨0.7) /2}

                    //if() { step = 3; }

                    // 36-1. ìº”ë²„ìŠ¤ í¬ê¸° ì¶•ì†Œ
                    if(scrollRatio > values.blendHeight[2].end){
                        //console.log('ì¶•ì†Œì‹œì‘');
                        values.canvas_scale[0] = canvasScaleRatio; //scaleì´ ëœ í¬ê¸°ë§Œí¼ ì´ˆê¸°ê°’
                        // 36-2. ë¸Œë¼ìš°ì €ì˜ í­ì´ ê´€ì—¬í•˜ê²Œë” ì¤„ì–´ë“¬ ìµœì¢…ê°’
                        values.canvas_scale[1] = document.body.offsetWidth / (1.5 * objs.canvas.width);
                        //console.log(values.canvas_scale[0], values.canvas_scale[1]); // ì´ˆê¸°, ìµœì¢…

                        values.canvas_scale[2].start = values.blendHeight[2].end;
                        values.canvas_scale[2].end = values.canvas_scale[2].start + 0.2;

                        // 36-3. ì‹¤ì œ ì ìš©
                        objs.canvas.style.transform = `scale(${calcValues(values.canvas_scale, currentYOffset)})`;
                        // 37-2. ë§ˆì§„ íƒ‘ ë•Œë¬¸ì— ì‚¬ë¼ì§€ëŠ”ê±° ì´ˆê¸°í™”
                        objs.canvas.style.marginTop = 0;
                    }
                    // 37. fixed í’€ê¸°
                    if(scrollRatio > values.canvas_scale[2].end && values.canvas_scale[2].end > 0){ // 1ë³´ë‹¤ ì‘ê³ (values.canvas_scale[2].endê°€ ì„¸íŒ…ë˜ê³ ), &&  0ë³´ë‹¤ í´ë•Œ
                        //console.log('scroll ì‹œì‘');
                        objs.canvas.classList.remove('sticky');

                        // 37-1. margin-top ì¤˜ì„œ ê³ ì •í•˜ê¸°
                        objs.canvas.style.marginTop = `${scrollHeight * 0.4}px`;

                        // 39. ìº”ë²„ìŠ¤ ìº¡ì…˜ ì»¨íŠ¸ë¡¤
                        values.canvasCaption_opacity[2].start = values.canvas_scale[2].end;
						values.canvasCaption_opacity[2].end = values.canvasCaption_opacity[2].start + 0.1;
						values.canvasCaption_translateY[2].start = values.canvasCaption_opacity[2].start;
						values.canvasCaption_translateY[2].end = values.canvasCaption_opacity[2].end;
						objs.canvasCaption.style.opacity = calcValues(values.canvasCaption_opacity, currentYOffset);
						objs.canvasCaption.style.transform = `translate3d(0, ${calcValues(values.canvasCaption_translateY, currentYOffset)}%, 0)`;
                    } else {
						objs.canvasCaption.style.opacity = values.canvasCaption_opacity[0];
					}

                }
                
                break;
        }
    } 

    // 4. ìŠ¤í¬ë¡¤ ì„¹ì…˜ íŒë³„
    function scrollLoop(){
        // 13-2. ìŠ¤í¬ë¡¤ í•  ë•Œë§ˆë‹¤ fasle ë°”ë€” ë•Œ true
        enterNewScene = false;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
        //YOffset = window.pageYOffset; // 4-3.ìŠ¤í¬ë¡¤ ì¼ì–´ë‚ ë•Œ y=pageYOffset
        //console.log(window.pageYOffset);// 4-1.ëª‡í”½ì…€ ìŠ¤í¬ë¡¤ ë˜ëŠ”ì§€
        //console.log(YOffset);
        // 4-4.ìŠ¤í¬ë¡¤ 4ì”¬. ì „ì²´ ê°’
        prevScrollHeight = 0; // 4.6 4êµ¬ê°„ì˜ scrollHeight í•© ì´ˆê¸°í™”
        for (let i = 0; i < currentScene; i++){
            //4-5.prevScrollHeight = prevScrollHeight + sceneInfo[i].scrollHeight;
            prevScrollHeight += sceneInfo[i].scrollHeight;
        }
        // 4.7 scrollheightí•˜ê³ ìˆëŠ” ë‚´ ìœ„ì¹˜ 
        //console.log(prevScrollHeight);

        // 4.8 currentScene ê°’ì„ í˜„ì¬ ìœ„ì¹˜ì— ë”°ë¼ +1, -1ì‹œì¼œì•¼ í•¨
        if (delayedYOffset > prevScrollHeight + sceneInfo[currentScene].scrollHeight) {
            // 13-3. ë°”ë€ŒëŠ” ìˆœê°„
            enterNewScene = true; 
            currentScene++;

            // 6-8.(ë°”ë€”ë•Œë§Œ ì„¸íŒ…)
            document.body.setAttribute('id', `show-scene-${currentScene}`);
        } 
        if (delayedYOffset < prevScrollHeight) {
            // 4-9. ë¸Œë¼ìš°ì € ë°”ìš´ìŠ¤ íš¨ê³¼ë¡œ ì¸í•´ ë§ˆì´ë„ˆìŠ¤ê°€ ë˜ëŠ” ê²ƒì„ ë°©ì§€(ëª¨ë°”ì¼) 
            if (currentScene === 0) return; 
            // 13-3. ë°”ë€ŒëŠ” ìˆœê°„
            enterNewScene = true; 
            currentScene--;

            // 6-9.(ë°”ë€”ë•Œë§Œ ì„¸íŒ…)
            document.body.setAttribute('id', `show-scene-${currentScene}`);
        }

        //console.log(currentScene);
        // 4-10.í˜„ì¬ í™œì„± ì”¬ ë°˜ì˜
        // 6-7. document.body.setAttribute('id', `show-scene-${currentScene}`); // 4-11. ë³€ìˆ˜ + ë¬¸ìì—´ = ë°±í‹±, currentSceneí˜„ì¬ ì”¬ì˜ ë²ˆí˜¸ (ë°”ë€”ë•Œë§Œ ì„¸íŒ…)
        
        // 13-4. scene ë°”ë€” ë•Œ ì‹¤í–‰ ì•ˆë¨
        if (enterNewScene) return;

        // 9-0
        playAnimation();
        
    }

    // 38-2. ìŠ¤í¬ë¡¤ ê°ì† ë£¨í”„ í•¨ìˆ˜
    function loop() {
        delayedYOffset = delayedYOffset + (YOffset - delayedYOffset) * acc;
        //box.style.width = `${delayedYOffset}px`;
        if (!enterNewScene || currentScene === 2){ // falseì¼ ë•Œ ì‹¤í–‰
            console.log('loop');
            if (currentScene === 0 || currentScene === 2) {
				const currentYOffset = delayedYOffset - prevScrollHeight;
				const objs = sceneInfo[currentScene].objs;
				const values = sceneInfo[currentScene].values;
				let sequence = Math.round(calcValues(values.imageSequence, currentYOffset));
				if (objs.videoImages[sequence]) {
					objs.context.drawImage(objs.videoImages[sequence], 0, 0);
				}
            }
        }

        rafId = requestAnimationFrame(loop);

        if (Math.abs(YOffset - delayedYOffset) < 1) {
            cancelAnimationFrame(rafId);
            rafState = false;
        }
    }



    window.addEventListener('scroll',() =>{ // 3-2. ëª‡ ë²ˆì§¸ ì„¹ì…˜ì„ ìŠ¤í¬ë¡¤ í•˜ëŠ”ì§€ íŒë³„, ìµëª…í•¨ìˆ˜
        YOffset = window.pageYOffset; // 4-3.ìŠ¤í¬ë¡¤ ì¼ì–´ë‚ ë•Œ y=pageYOffset
        scrollLoop();
        checkMenu();

        // 38-1. scroll ê°ì†
        if (!rafState) {
            rafId = requestAnimationFrame(loop);
            rafState = true;
        }
    });

    // 5. í˜„ì¬ í™œì„± ì”¬ ë°˜ì˜
    //window.addEventListener('load', setLayout); // 5-1. ë¡œë“œë˜ë©´ ì‹¤í–‰, load(ì´ë¯¸ì§€ê¹Œì§€ ì‹¹ë‹¤ ë¡œë“œí›„ ì‹¤í–‰) = DOMContentLoaded(HTMLê°ì²´ êµ¬ì¡°ë§Œ ë¡œë“œ ëë‚˜ë©´ ì‹¤í–‰)ë„ ê°€ëŠ¥ 
    // 23. ì´ë²¤íŠ¸ í™”ë©´ìƒ ë”± ë–´ì„ë•Œ ë§Œë“¤ê¸°
    window.addEventListener('load', () =>{
        setLayout();
        // 23-1. ë‹¤ë¥¸ ê²ƒë“¤ ì´ˆê¸°í™” ì‘ì—…(ê·¸ë¦¬ê³  ì‹œì‘í•˜ê²Œ)
        sceneInfo[0].objs.context.drawImage(sceneInfo[0].objs.videoImages[0], 0, 0); //ì‹œí€€ìŠ¤ ì²«ë²ˆì§¸ì´ë¯¸ì§€ ë¡œë“œ
    });
    // 3. ì´ë²¤íŠ¸ ì ìš© 
    window.addEventListener('resize', setLayout); // 3-1.ìœˆë„ìš° ì°½ í¬ê¸°ê°€ ë³€í•  ë•Œ, setLayout ì‹œì‘
   
    
    //setLayout( // 3-0. ì„ ì–¸( sceneinfoì— ìˆëŠ” ê° ì”¬ì˜ scrollheightë¥¼ ì¡ì•„ì£¼ê³ , ê·¸ scrollheightê°’ì„ ê°€ì§€ê³  scrollsectionElementì˜ ë†’ì´ë¡œ ì„¸íŒ…)
    //); 
})();

console.log('^^');